---
title: Claude Code使用指北（ 如何白嫖百万Qwen3 Token,每月劲省20刀)
tags:
- 个人成长
categories:
- 杂谈
---

[TOC]


 Claude Code 工具本身是免费的，可以通过环境变量，指定大模型的接入地址，接入的模型名，和按量付费的 key；

Cursor订阅费用每月 20 刀，截止2025年10月，claude code完成2.0.13更新后，完全支持rewind回滚，已经完全平替了cursor最好用的功能，配合国产大模型的百万token免费，和疯狂的token价格战，目前是入坑Claude code的最好时机。

## 1. 国产大模型厂商对Claude Code 的适配

![](https://cdn.fangyuanxiaozhan.com/assets/1760229687990WzXG5WhK.png)



国产大模型厂商也Claude Code 进行了积极适配：

DeepSeek使用 Claude code 的适配教程:（推荐） 

https://api-docs.deepseek.com/guides/anthropic_api

智普GLM使用Claude code 的教程:

https://docs.z.ai/scenario-example/develop-tools/claude

阿里百炼通义千问使用Claude code 的教程（可白嫖）:

https://help.aliyun.com/zh/model-studio/claude-code



## 2. 安装Claude code

Windows 用户请使用 WSL2 获得好的的体验，先完成Node.js的安装后再安装 Claude code

```
npm install -g @anthropic-ai/claude-code
```

![image-20251012090343385](https://cdn.fangyuanxiaozhan.com/assets/1760231028673RYa5mamN.png)

## 3. 白嫖Qwen百万token

安装完成后，可以在环境变量写一个国产大模型的接入点配置，这里以可以白嫖 100万 token 的阿里通义千问 qwen3-coder-plus-2025-07-22  模型为例

```
# 代码能力第一梯队的国产模型 qwen3-coder-plus-2025-07-22

export ANTHROPIC_BASE_URL=https://dashscope.aliyuncs.com/api/v2/apps/claude-code-proxy
export ANTHROPIC_AUTH_TOKEN=sk-*********
export ANTHROPIC_MODEL="Qwen/qwen3-coder-plus-2025-07-22"


# 关闭遥测
export CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC=1

```

如何获取 ANTHROPIC_AUTH_TOKEN ？前往阿里云百炼平台获取 key 即可（为了避免推广的嫌疑，自己用 bing.cn 搜阿里云百炼就能获取了）

![img_v3_02q9_fcedc4ca-f52a-4749-b85d-22cde10c931g](https://cdn.fangyuanxiaozhan.com/assets/1758352383324mpxedrbQ.jpeg)

## 4. 初始化Claude Code

在命令行输入 claude即可启动，并开始基础配置

选择主题

![image-20250920150211089](https://cdn.fangyuanxiaozhan.com/assets/1758351733553NN7CKWFf.png)

默认 Dark mode，回车；


告诉用户claude 可能会犯错

![image-20250920150325808](https://cdn.fangyuanxiaozhan.com/assets/175835180740671Y5iB60.png)

使用推荐配置，比如使用 shift+enter 可以换行


![image-20250920150353058](https://cdn.fangyuanxiaozhan.com/assets/1758351834807aGYkpE5m.png)



询问是否给 Claude 读写当前所在文件夹的权限


![image-20250920150554924](https://cdn.fangyuanxiaozhan.com/assets/1758351956514p2Y74jRJ.png)

这里如果不同意，就只能退出Claude code；

推荐用户只在代码项目路径运行 claude code； 这里我们即使选择了 yes, proceed，claude code 在修改文件时，依然会先问我们是否修改，所以这里依然可以继续选择 yes，proceed，然后回车。

![image-20250920151613266](https://cdn.fangyuanxiaozhan.com/assets/1758352578722PYN48kDB.png)

输入/model 回车，可以看到当前使用的免费模型



![image-20250920151708159](https://cdn.fangyuanxiaozhan.com/assets/1758352629767pP0fBPtZ.png)



### 纯自然语言开始新需求



![image-20250920152501898](https://cdn.fangyuanxiaozhan.com/assets/1758353107556zsdnHi5s.png)

![image-20250920152847234](https://cdn.fangyuanxiaozhan.com/assets/17583533347356RwzCnbT.png)

继续安装依赖包

![image-20250920153007337](https://cdn.fangyuanxiaozhan.com/assets/175835341224520xt0S0c.png)

我刚刚选了几次无需询问特定的命令，claude 把我的项目习惯纪录到了项目的.claude文件夹里的 settting.local.json 里面

![image-20250920153102461](https://cdn.fangyuanxiaozhan.com/assets/17583534670222n7FNhFf.png)

自动改代码，并启动项目

![image-20250920153314368](https://cdn.fangyuanxiaozhan.com/assets/1758353600834NPsBpfyP.png)

完成了第一版

![image-20250920153446077](https://cdn.fangyuanxiaozhan.com/assets/1758353698503kFF4idWp.png)

### VScode精准定位

但我不满意，于是打开 vscode，用低 token 的方式进行精细化调整（如果你不懂代码，可以继续直接终端对话，让 ai 自己改，虽然也能达到目的，但比较费时间，也比较费钱， token 归根到底是要花钱买的）

![image-20250920153752034](https://cdn.fangyuanxiaozhan.com/assets/17583538808421pp2sQDt.png)

如果你不习惯使用vscode终端，可以在任意窗口打开claude，然后完成对vscode的关联，即可自动感知vscode代码选中等逻辑



![](https://cdn.fangyuanxiaozhan.com/assets/17602298652130StywPjj.png)



![](https://cdn.fangyuanxiaozhan.com/assets/1760229880476JsxKAbGx.png)

截图给大模型，提要求，选中代码，进行精细化调整，这种做法可以平替 cursor

![image-20250920154326179](https://cdn.fangyuanxiaozhan.com/assets/1758354207609DK1hTYf6.png)

修改后，如果不满意，我们可以继续贴图，继续调整，直到满意为止

![image-20250920160451026](https://cdn.fangyuanxiaozhan.com/assets/17583554943923ENtSmCB.png)

## 5.更进阶的模型分流


![82bf843100854bac8eb7cf29dba674d5~tplv-ry4let6mk6-image](https://cdn.fangyuanxiaozhan.com/assets/1758357019691Wd4tZJAw.png)


https://github.com/musistudio/claude-code-router

如果你是大模型写代码的狂热爱好者，可以对各种模型取长补短，开源项目claude-code-router可以对大模型的不同操作进行分流，实现更低的消耗，更好的体验
```
"Router": {
    "default": "deepseek,deepseek-chat",
    "background": "ollama,qwen2.5-coder:latest",
    "think": "deepseek,deepseek-reasoner",
    "longContext": "openrouter,google/gemini-2.5-pro-preview",
    "webSearch": "gemini,gemini-2.5-flash"
  }
```
 使用以上配置，默认对话走 deepseek-chat 模型(无 thinking)，简单的操作使用 qwen2.5-coder（比如在本地查个目录，找个文件什么）; 思考分析则使用 deepseek-reasoner（对复杂任务创建一些 planning，带 thinking）; 超长对话则转换到gemini-2.5-pro-preview（发挥gemini上下文的优势）; 涉及到web 搜索则使用 gemini-2.5-flash（相当于用了google 的搜索）

实用主义：使用 claude code router 配合qwen3-vl-235b-a22b-instruct实现图片读取，我们目前只有 通义千问可纯白嫖，很不巧的是 `qwen3-coder-plus` 不支持图片输入, 我们必须把支持图片输入的 `qwen3-vl-235b-a22b-instruct` 作为默认模型进行设置，才能实现图片读取, claude code router 的配置文件所在位置 `~/.claude-code-router/config.json`

```
{
  "LOG": false,
  "LOG_LEVEL": "debug",
  "CLAUDE_PATH": "",
  "HOST": "127.0.0.1",
  "PORT": 3456,
  "APIKEY": "",
  "API_TIMEOUT_MS": "600000",
  "PROXY_URL": "",
  "transformers": [],
  "Providers": [
    {
      "name": "dashscope",
      "api_base_url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
      "api_key": "sk-61*****************f",
      "models": [
        "qwen3-coder-plus",
        "qwen3-vl-235b-a22b-instruct"
      ],
      "transformer": {
        "use": [
          [
            "maxtoken",
            {
              "max_tokens": 65536
            }
          ]
        ],
        "qwen3-coder-plus": {
          "use": [
            "enhancetool"
          ]
        }
      }
    }
  ],
  "StatusLine": {
    "enabled": false,
    "currentStyle": "default",
    "default": {
      "modules": []
    },
    "powerline": {
      "modules": []
    }
  },
  "Router": {
    "default": "dashscope,qwen3-vl-235b-a22b-instruct",
    "background": "dashscope,qwen3-coder-plus",
    "think": "dashscope,qwen3-coder-plus",
    "longContext": "dashscope,qwen3-coder-plus",
    "longContextThreshold": 60000,
    "webSearch": "dashscope,qwen3-coder-plus",
    "image": "dashscope,qwen3-vl-235b-a22b-instruct"
  },
  "CUSTOM_ROUTER_PATH": ""
}

```

claude code router做的好的一点是，帮你分流, 并间接做了 try catch，你输入了图片给 qwen3-coder-plus,  模型会返回失败，而经过claude code router的封装会把上传图片这个失败的请求处理掉，不像claude code 原生客户端一样，直接报 500

比较搞的是，qwen3-vl-235b-a22b-instruct 并不在百炼提供的 Anthropic API 适配列表里，加钱也不行

![img_v3_02qj_340b0449-c79d-4c4a-8434-2614b3ac60dg](https://cdn.fangyuanxiaozhan.com/assets/1760228664872aM1DcZpS.jpeg)

claude code router作为一个第三方工具，搞了兼容层适配代码，让你可以更自由的调用各类模型

使用 `ccr code` 可以启动 claude code，如果嫌命令长，可以自行设置alias

```
alias cc='ccr code'
```

## 6. 接入MCP

Claude code的mcp是绑定到项目路径的，可以通过`~/.claude.json` 查看和进行配置

### 推荐的MCP

```
# Figma
claude mcp add --transport http figma-dev-mode-mcp-server http://127.0.0.1:3845/mcp

# 读文档
claude mcp add context7 -- npx -y @upstash/context7-mcp

# 浏览器控制playwright
claude mcp add playwright npx @playwright/mcp@latest

# chrome-devtools
claude mcp add chrome-devtools npx chrome-devtools-mcp@latest

```

![image](https://cdn.fangyuanxiaozhan.com/assets/1760228781641MK6raiBp.png)



查看特定路径项目已经添加的mcp信息, `~/.claude.json`

![](https://cdn.fangyuanxiaozhan.com/assets/1760228801904kKFMeRKf.png)

检测已经添加的`mcp` 

```Plain
claude mcp list
```

![](https://cdn.fangyuanxiaozhan.com/assets/1760228839142GhSsMCp4.png)

### 通过MCP读取Apifox接口文档

![](https://cdn.fangyuanxiaozhan.com/assets/1760228888397yHJmTzhP.png)



然后claude code就可以看到api文档了，有利于自动编写连调代码

![image-20251012082929272](https://cdn.fangyuanxiaozhan.com/assets/1760228970552HeHAZXah.png)

## 7. 用SubAgent进行代码检查

subAgent官方code review示例如下，定义了subAgent的名称，描述，可以调用的工具，以及使用的模型，其中model字段使用 inherit 即可（继承父级）

```YAML
---
name: code-reviewer
description: Expert code review specialist. Proactively reviews code for quality, security, and maintainability. Use immediately after writing or modifying code.
tools: Read, Grep, Glob, Bash
model: inherit
---

You are a senior code reviewer ensuring high standards of code quality and security.

When invoked:
1. Run git diff to see recent changes
2. Focus on modified files
3. Begin review immediately

Review checklist:
- Code is simple and readable
- Functions and variables are well-named
- No duplicated code
- Proper error handling
- No exposed secrets or API keys
- Input validation implemented
- Good test coverage
- Performance considerations addressed

Provide feedback organized by priority:
- Critical issues (must fix)
- Warnings (should fix)
- Suggestions (consider improving)

Include specific examples of how to fix issues.
```

我们也可以通过一些github仓库找到一些好的提示词 https://github.com/hesreallyhim/awesome-claude-code-agents/blob/main/agents/senior-code-reviewer.md

定义完成后，可以在`.claude/agents`  目录下看到subAgent对应的文件



![](https://cdn.fangyuanxiaozhan.com/assets/1760229088599KBmpbX82.png)

调用方法也很简单，通过自然语言调用即可

```
Use the senior-code-reviewer subagent to check my recent changes
```

**请记得使用code-review，尽量减少垃圾代码的提交**

![](https://cdn.fangyuanxiaozhan.com/assets/17602291600185BHXNp5C.png)



有了subAgent，结对编程不是梦

![image-20251012085957913](https://cdn.fangyuanxiaozhan.com/assets/1760230801000R4PriK4s.png)



## 8. 团队编程

![](https://cdn.fangyuanxiaozhan.com/assets/1760229241677Wsa0CYBz.png)

与`.git` 类似，在项目根目录建立 `.claude` 文件夹，即可保持团队开发的提示词，subAgent等配置同步



##  9. 常见问题

### Enter换行经常误按，导致对话没写完就被发出去，如何解决？

1. 通过 `/vim` 切换到vim模式
2. 使用 `\+Enter` 换行
3. 习惯使用 `shift + Enter` 进行换行

![](https://cdn.fangyuanxiaozhan.com/assets/1760229317525szyC66jm.png)

### 如何退出Claude Code？意外退出后如何继续对话

如果需要退出，则输入 `/exit` 或 `/q` 

如果是意外退出，需要恢复，输入claude 进入工具后，输入 `/resume` 即可选择之前的对话(注意，这里的 resume是针对项目目录的，如果离开项目目录，则 resume无效)

![image (9)](https://cdn.fangyuanxiaozhan.com/assets/1760229365717QaSJ4xfz.png)

如何查看当前对话的完整聊天记录？使用`Ctrl+O` 组合键，即可查看历史记录的对话

### 上下文过长导致token消耗速率过快怎么办？

![](https://cdn.fangyuanxiaozhan.com/assets/1760229432720pNhkJRJ1.png)

`/compact` - 清空对话历史，但保留**压缩摘要**在上下文中

`/clear` 彻底清理对话（不保留上下文）

`/rewind` 回滚无用的步骤（Claude Code 2.0最近支持的功能，2.0 早期版本有bug，请升级到 2.0.13 以上的版本）

`Esc` ：在输出阶段发现情况不对，立刻按`Esc` 即可快速打断

![](https://cdn.fangyuanxiaozhan.com/assets/1760229458955yWaZmA6E.png)

### 关于nomal，plan mode on ，accept edits on 三个模式的切换，以及Thinking on模式

Claude code默认不启用thinking模式，Thinking on 与 Thinking off 切换使用`Tab` 

`nomal`，`plan mode on` ，`accept edits on` 三个模式使用 `Tab + Shift` 进行切换

`nomal`作为默认模式，是够用的，对于新手，可以在nomal模式里做任何事

`plan mode on` 和 `accept edits on`  作为进阶模式，是要配合一起使用的

具体的使用实例：

 `plan mode on` 模式默认是不能修改文件的，对`plan`满意后，用户可以切换到`accept edits on` 模式对文件进行修改；

![](https://cdn.fangyuanxiaozhan.com/assets/1760229491364rwRxbaim.png)

nomal模式也可以修改文件，但几乎每个修改都需要用户确认，而accept edits on 模式可以批量修改

![](https://cdn.fangyuanxiaozhan.com/assets/1760229514505aKhH701h.png)

默认开启plan模式是好习惯，我们可以在配置文件中默认以plan模式启动

![](https://cdn.fangyuanxiaozhan.com/assets/1760229540275EbXDP0Ee.png)



```Plain
// .claude/settings.json
{
  "permissions": {
    "defaultMode": "plan"
  }
}
```

### 如何在Claude code中快速执行命令?

使用`!` 进入base model即可， 比如添加mcp

```
!claude mcp add playwright npx @playwright/mcp@latest
```

## 10. 推荐的资源

Claude Code 官方中文文档： https://docs.anthropic.com/zh-CN/docs/claude-code/overview

![](https://cdn.fangyuanxiaozhan.com/assets/1760229654397x02DH76W.png)

Claude Code增强： https://github.com/SuperClaude-Org/SuperClaude_Framework

Claude Code计费（一个实时量化显示烧钱效率的超酷面板）：https://github.com/ryoppippi/ccusage

![](https://cdn.fangyuanxiaozhan.com/assets/1760229623986tRKDXK43.png)

Claude Code Subagent： https://github.com/VoltAgent/awesome-claude-code-subagents

## Claude code 体验小结

Claude code 的出现让代码变得不值钱，但是并不是程序员变得不值钱，比如上面的示例中就有一个大模型将zIndex设置为负值，导致星星无法显示的 bug，开始我完全信任大模型，但绕了几轮花费大量 token，依然无发修复，最后我亲自打开 vscode， 花了一分钟定位问题，找到 zIndex那一行代码，改为一个合理的值，立刻正常运行了。

![](https://cdn.fangyuanxiaozhan.com/assets/1760230934455zXp0rrR1.png)

Claude code 确实是一个很优雅的工具，直接和文件系统打交道，高效简单，配合各种 IDE适配，确实能极大提高编码效率。

对程序员这个职业而言，编码只是工作的一部分， Claude code 配合国产大模型，确实能让我们有机会用更少的时间写成更好的代码。

以前大家常说，人生苦短，我用 Python；现在是人生苦短，我用 Claude code； 不过，回顾历史，用了 python 后的程序员，也没有真正闲下来，因为程序员是个需求驱动的职业，代码效率提高了，提新需求的效率也会水涨船高。

![](https://cdn.fangyuanxiaozhan.com/assets/17602308813158YaFRRjw.png)

有人说 Claude code 会取代程序员这个职业，我的建议是开发者都能尝试 Claude Code 写一些代码，最大的祛魅是拥有，品过后，了解Claude code 真实的使用体验，自然就没那么焦虑了。



