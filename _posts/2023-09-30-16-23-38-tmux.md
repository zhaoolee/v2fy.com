---
title: å¦‚ä½•é¿å…æ‰‹æŠ–å…³é—­ç»ˆç«¯å¯¼è‡´ç¨‹åºä¸­æ–­ï¼Ÿå¦‚ä½•ä¿è¯sshæ–­å¼€ä¸ä¸¢å¤±ä¼šè¯ï¼Ÿé™å‹å°å·¥å…·Tmux / How to prevent program interruption by accidentally closing the terminal? How to ensure that the ssh disconnection does not lose the session? Pressure-reducing tool Tmux
tags:
- ä¸ªäººæˆé•¿
categories:
- æå®¢å®ç”¨æŠ€å·§ / Geek Practical Skills
---


å†™ç¨‹åºéœ€è¦å°†ç§˜é’¥tokenä¸´æ—¶æ”¾å…¥ç¯å¢ƒå˜é‡ï¼Œä½†å…³é—­çª—å£ï¼Œå°±ä¼šä¸¢å¤±ä¼šè¯ï¼ˆsessionï¼‰ï¼Œç§˜é’¥tokenä¿¡æ¯ä¹Ÿä¼šé”€æ¯ã€‚

ğŸŒˆWhen writing a program, you need to temporarily put the secret token into the environment variable, but if you close the window, the session will be lost and the secret token information will also be destroyed.


æœ‰äº›ç¨‹åºéœ€è¦åœ¨æœåŠ¡ç«¯è°ƒè¯•ï¼ŒæŸ¥çœ‹å®æ—¶çš„logï¼Œå¦‚æœè¿œç¨‹å·¥ä½œç½‘ç»œä¸ç¨³å®šï¼Œsshæ–­å¼€ï¼Œé‡è¿ç™»å½•åï¼Œæƒ³è¦ç»§ç»­è°ƒè¯•ï¼Œè¿˜è¦é‡å¯ç¨‹åºï¼Œå¦‚æœé¢‘ç¹æ‰çº¿ï¼ŒçœŸçš„æ˜¯è¡€å‹é£™å‡ã€‚

ğŸŒˆSome programs need to be debugged on the server and view real-time logs. If the remote work network is unstable and ssh is disconnected, you need to restart the program to continue debugging after reconnection and login. If the connection is frequently dropped, it really raises your blood pressure.


ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Tmuxè¿›è¡Œsessionç®¡ç†ï¼Œä»è€Œè§£å†³sshæ–­å¼€åï¼Œsessionä¿¡æ¯ä¸¢å¤±çš„é—®é¢˜ã€‚

ğŸŒˆTo solve the above problems, we can use Tmux for session management, thereby solving the problem of session information loss after ssh is disconnected.


## æ‰“ä¸ªæ¯”æ–¹ / For Example

ä¸ä½¿ç”¨Tmuxï¼Œç›¸å½“äºåœ¨å®¶ç©å•æœºæ¸¸æˆï¼Œå®¶é‡Œåœç”µäº†ï¼Œæœªå­˜æ¡£çš„æ¸¸æˆè¿›åº¦å°±ä¸¢å¤±äº†ï¼›

ğŸŒˆNot using Tmux is like playing a standalone game at home. If there is a power outage at home, the unsaved game progress will be lost;

ä½¿ç”¨Tmuxï¼Œç›¸å½“äºç”¨äº‘ä¸»æœºç©å•æœºæ¸¸æˆï¼Œå³ä½¿å®¶é‡Œåœç”µäº†ï¼Œäº‘ä¸»æœºä¾ç„¶ä¿ç•™ä½ çš„æ¸¸æˆè¿›åº¦ï¼Œä½ é‡è¿ä¸Šå»ï¼Œè¿˜å¯ä»¥æ¥ç€ç©ã€‚

ğŸŒˆUsing Tmux is like playing a standalone game with a cloud host. Even if there is a power outage at home, the cloud host still retains your game progress. You can continue to play after reconnecting.



## æœåŠ¡ç«¯å®‰è£…Tmux / Installing Tmux on the Server

å®¢æˆ·ç«¯å¹¶ä¸éœ€è¦å®‰è£…Tmuxï¼ŒTmuxæ˜¯ä¸ªæœåŠ¡ç«¯è½¯ä»¶ã€‚

ğŸŒˆThe client does not need to install Tmux, Tmux is a server software.

```
apt install tmux
```

Tmuxå¼€æºåœ°å€ https://github.com/tmux/tmux

ğŸŒˆThe open-source address for Tmux: https://github.com/tmux/tmux

![image-20230930171915323 / Image-20230930171915323](https://cdn.fangyuanxiaozhan.com/assets/16960655567654HsWm8nM.png)



## Tmuxæœ€æ ¸å¿ƒçš„åŠŸèƒ½æ€ä¹ˆç”¨ / How to Use the Core Function of Tmux

Tmuxæ˜¯ä¸€ä¸ªsession(ä¼šè¯)ç®¡ç†å·¥å…·ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨Tmuxå°±å¿…é¡»åˆ›å»ºsessionï¼Œæ¯ä¸ªsessionå¯ä»¥å¯¹åº”å¤šä¸ªwindow(çª—å£)ï¼Œ æ¯ä¸ªçª—å£å¯ä»¥å¯¹åº”å¤šä¸ªpane(çª—æ ¼), paneå±äºå¢å¼ºåŠŸèƒ½ï¼Œç›¸å½“äºå¼€å‡ ä¸ªç›¸åŒsessionçš„çª—å£ï¼Œæœ¬æœŸå…ˆä¸è®²ã€‚

ğŸŒˆTmux is a session management tool. To use Tmux, we must create a session. Each session can correspond to multiple windows, and each window can correspond to multiple panes. Panes are an enhanced feature, equivalent to opening several windows of the same session. We won't talk about it in this issue.

åˆ›å»ºsession

ğŸŒˆCreate a session

```
# åˆ›å»ºsessionååº•éƒ¨ä¼šç»™å‡ºsessionçš„ç¼–å·, ç¬¬ä¸€ä¸ªé»˜è®¤ç¼–å·ä¸º0 / After creating a session, the session number will be given at the bottom. The default number for the first one is 0
tmux new
```

![image-20230930172207011 / Image-20230930172207011](https://cdn.fangyuanxiaozhan.com/assets/1696065727783TDCNXEcK.png)

æˆ‘ä»¬å¯ä»¥å†æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œç™»å½•åˆ°æœåŠ¡å™¨ï¼Œé€šè¿‡è¿è¡Œ`tmux ls` å³å¯çœ‹åˆ°å½“å‰å¯ç”¨çš„session

ğŸŒˆWe can open another terminal, log in to the server, and see the currently available session by running `tmux ls`

![image-20230930172712045 / Image-20230930172712045](https://cdn.fangyuanxiaozhan.com/assets/1696066032803Nbn6wyWJ.png)

æ–°æ‰“å¼€çš„çª—å£ä¹Ÿå¯ä»¥ä½¿ç”¨ç¼–å·ä¸º`0` çš„session

ğŸŒˆThe newly opened window can also use the session with the number `0`

```
# æ–°çª—å£åŠ å…¥ç¼–å·ä¸º0çš„session / The new window joins the session with the number 0
tmux attach -t 0
```

ç„¶åæœ‰æ„æ€çš„æ¥äº†ï¼Œç”±äºä¸¤ä¸ªçª—å£å…±ç”¨äº†ç›¸åŒçš„sessionï¼Œåœ¨ç¬¬ä¸€ä¸ªçª—å£è¾“å…¥å‘½ä»¤ï¼Œç¬¬äºŒä¸ªçª—å£ä¹Ÿä¼šåŒæ­¥æ˜¾ç¤ºï¼Œ

ğŸŒˆThen the interesting thing comes. Because the two windows share the same session, when you enter a command in the first window, the second window will also be synchronized.

![2023-09-30 17.30.04 / 2023-09-30 17.30.04](https://cdn.fangyuanxiaozhan.com/assets/1696066274426Jy0MASe5.gif)

è¿™è¯´æ˜è¿è¡Œåœ¨æœåŠ¡ç«¯çš„tmuxåœ¨å¸®æˆ‘ä»¬ç®¡ç†sessionçŠ¶æ€ï¼Œç”¨æˆ·çš„è¾“å…¥ä»¥åŠæœåŠ¡å™¨çš„è¾“å‡ºï¼ŒåŠ å…¥åŒä¸€ä¸ªsessionçš„ç”¨æˆ·éƒ½å¯ä»¥å®æ—¶çœ‹åˆ°ã€‚

ğŸŒˆThis shows that the tmux running on the server is helping us manage the session status. The user's input and the server's output can be seen in real time by users who join the same session.


å¦‚æœæˆ‘ä»¬æƒ³è¦**é€€å‡ºå½“å‰sessionè€Œä¸é”€æ¯session**ï¼Œ**ç›´æ¥å…³é—­çª—å£**æˆ–è¿è¡Œ`detach` , å³å¯ã€‚

ğŸŒˆIf we want to **exit the current session without destroying the session**, you can **directly close the window** or run `detach`.

å¦‚æœæˆ‘ä»¬æƒ³è¦**é€€å‡ºå¹¶é”€æ¯å½“å‰session**ï¼Œåœ¨sessionå†…è¿è¡Œ`exit` ï¼Œæˆ–åœ¨ä»»æ„ç»ˆç«¯ä»»ä½•çŠ¶æ€è¿è¡Œ `tmux kill-session -t 0` å³å¯ã€‚

ğŸŒˆIf we want to **exit and destroy the current session**, run `exit` in the session, or run `tmux kill-session -t 0` in any terminal under any state.


ä»¥ä¸Šå°±æ˜¯Tmuxæœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æœåŠ¡ç«¯åˆ›å»ºsessionï¼Œå¸®æˆ‘ä»¬å³ä½¿åœ¨æ–­ç½‘åï¼Œä¹Ÿèƒ½ä¿å­˜ç¯å¢ƒå˜é‡ä¸­çš„Tokenï¼Œ ä¿è¯è°ƒè¯•ç¨‹åºçš„logæŒç»­æ‰“å°ã€‚

ğŸŒˆThe above is the core function of Tmux. It can create a session on the server to help us save the Token in the environment variable even after the network is disconnected, and ensure that the logs of the debugging program are continuously printed.

å¦‚æœä½ ä¸éœ€è¦ä¸æœåŠ¡å™¨æ‰“äº¤é“ï¼Œå°†Tmuxå®‰è£…è¿è¡Œåœ¨æœ¬æœºï¼Œä¹Ÿèƒ½é¿å…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ‰‹æŠ½å…³é—­æŸä¸ªçª—å£ï¼Œå¯¼è‡´è·‘äº†å¾ˆä¹…çš„ç¨‹åºè¢«ä¸­æ–­ã€‚

ğŸŒˆIf you don't need to deal with the server, installing and running Tmux on your local machine can also prevent a long-running program from being interrupted by accidentally closing a window during development.



## å°ç»“ / Summary

Tmuxæ˜¯ä¸€ä¸ªå¼±ç½‘åŠå…¬çš„å¥½å·¥å…·ï¼Œå¦‚æœä½ ç»å¸¸è¢«sshæ–­ç½‘ä¸¢å¤±è¿›åº¦å›°æ‰°ï¼Œæˆ–è€…æ‰‹æŠ–å…³é—­æœ¬åœ°ç»ˆç«¯çª—å£ï¼Œä¸å¦¨è¯•ä¸€ä¸‹Tmuxï¼Œå¥½å·¥å…·èƒ½åŸ¹å…»å¥½å¿ƒæ€ã€‚

ğŸŒˆTmux is a good tool for working in a weak network environment. If you are often troubled by ssh disconnection and loss of progress, or if you accidentally close the local terminal window, you might as well try Tmux. Good tools can cultivate a good mindset.
